!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Selection=t()}(this,(function(){"use strict";String(Math.random()).slice(2),document.createComment(""),document.createElement("template"),document.createTextNode("");let e=!1;(()=>{try{const t={get capture(){return e=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(e){}})(),"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.5");document.createElement("template");class t{constructor(){this.isAction=!0}}t.prototype.isAction=!0;document.createTextNode("");return function(e={}){let i,s,n,c;const o="config.plugin.selection",r="gantt-schedule-timeline-caledar__plugin-selection-rect",l=document.createElement("div");l.classList.add(r),l.style.visibility="hidden",l.style.left="0px",l.style.top="0px",l.style.width="0px",l.style.height="0px",l.style.background="rgba(0, 119, 192, 0.2)",l.style.border="2px dashed rgba(0, 119, 192, 0.75)",l.style.position="absolute",l.style["user-select"]="none",l.style["pointer-events"]="none";const m={grid:!1,items:!0,rows:!1,horizontal:!0,vertical:!0,rectStyle:{},selecting(){},deselecting(){},selected(){},deselected(){},canSelect:(e,t,i)=>t,canDeselect:(e,t,i)=>[],getApi(){}};e=Object.assign(Object.assign({},m),e);for(const t in e.rectStyle)l.style[t]=e.rectStyle[t];const a={fromX:-1,fromY:-1,toX:-1,toY:-1,startX:-1,startY:-1,startCell:!1,selecting:!1},d={"chart-timeline-grid-row":e=>e.row.id,"chart-timeline-grid-row-block":e=>e.id,"chart-timeline-items-row":e=>e.row.id,"chart-timeline-items-row-item":e=>e.item.id};function h(e,t=!1){t?s.update(`${o}.selecting`,t=>{for(const i in t)e[i].forEach(e=>{t[i].includes()||t[i].push(e)});return t}):s.update(`${o}.selecting`,e),s.update("config.chart.items",(function(t){const i=e["chart-timeline-items-row-items"];for(const e in t){const s=t[e];i.includes(s.id)?s.selecting=!0:s.selecting=!1}return t}),{only:["selecting"]}),s.update("_internal.chart.grid.rowsWithBlocks",(function(t){const i=e["chart-timeline-grid-row-blocks"],s=e["chart-timeline-grid-rows"];if(t)for(const e of t){s.includes(e.id)?e.selecting=!0:e.selecting=!1;for(const t of e.blocks)i.includes(t.id)?t.selecting=!0:t.selecting=!1}return t}))}function g(t=!1,i=!1){let n;i?s.update(o,e=>(n={selecting:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},selected:e.selected},n)):(s.update(o,i=>(n={selecting:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},selected:{"chart-timeline-grid-rows":t?[]:e.canDeselect("chart-timeline-grid-rows",i.selected["chart-timeline-grid-rows"],i),"chart-timeline-grid-row-blocks":t?[]:e.canDeselect("chart-timeline-grid-row-blocks",i.selected["chart-timeline-grid-row-blocks"],i),"chart-timeline-items-rows":t?[]:e.canDeselect("chart-timeline-items-rows",i.selected["chart-timeline-items-rows"],i),"chart-timeline-items-row-items":t?[]:e.canDeselect("chart-timeline-items-row-items",i.selected["chart-timeline-items-row-items"],i)}},n)),s.update("_internal.chart.grid.rowsWithBlocks",(function(e){if(e)for(const t of e)for(const e of t.blocks)e.selected=n.selected["chart-timeline-grid-row-blocks"].includes(e.id),e.selecting=!1;return e})),s.update("config.chart.items",e=>{if(e)for(const t in e){const i=e[t];i.selected=n.selected["chart-timeline-items-row-items"].includes(t),i.selecting=!1}return e}))}let u;function w(t=!1){a.selecting=!1,l.style.visibility="hidden";const i=f(s.get(o)),n={};t?s.update(o,e=>{const t=Object.assign({},e.selecting);for(const i in e.selected)for(const s of t[i])e.selected[i].includes(s)||e.selected[i].push(s);return n.selected=Object.assign({},e.selected),n.selecting={"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},n}):s.update(o,e=>(n.selected=Object.assign({},e.selecting),n.selecting={"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},n));const c=s.get("_internal.elements");for(const t in d)if(c[t+"s"])for(const s of c[t+"s"])i.selecting[t+"s"].includes(s.vido.id)&&e.deselecting(s.vido,t);s.update("config.chart.items",(function(s){for(const n in s){const c=s[n];i.selecting["chart-timeline-items-row-items"].includes(c.id)?(c.selected=!0,void 0!==c.selected&&c.selected||e.selected(c,"chart-timeline-items-row-item")):t&&u.selected["chart-timeline-items-row-items"].includes(c.id)?c.selected=!0:(c.selected=!1,i.selected["chart-timeline-items-row-items"].includes(c.id)&&e.deselected(c,"chart-timeline-items-row-item"))}return s})),s.update("_internal.chart.grid.rowsWithBlocks",(function(s){if(s)for(const n of s)for(const s of n.blocks)i.selecting["chart-timeline-grid-row-blocks"].includes(s.id)?(void 0!==s.selected&&s.selected||e.selected(s,"chart-timeline-grid-row-block"),s.selected=!0):t&&u.selected["chart-timeline-grid-row-blocks"].includes(s.id)?s.selected=!0:(i.selected["chart-timeline-grid-row-blocks"].includes(s.id)&&e.deselected(s,"chart-timeline-grid-row-block"),s.selected=!1);return s}))}function f(e){const t={};return t.selecting=Object.assign({},e.selecting),t.selecting["chart-timeline-grid-rows"]=e.selecting["chart-timeline-grid-rows"].slice(),t.selecting["chart-timeline-grid-row-blocks"]=e.selecting["chart-timeline-grid-row-blocks"].slice(),t.selecting["chart-timeline-items-rows"]=e.selecting["chart-timeline-items-rows"].slice(),t.selecting["chart-timeline-items-row-items"]=e.selecting["chart-timeline-items-row-items"].slice(),t.selected=Object.assign({},e.selected),t.selected["chart-timeline-grid-rows"]=e.selected["chart-timeline-grid-rows"].slice(),t.selected["chart-timeline-grid-row-blocks"]=e.selected["chart-timeline-grid-row-blocks"].slice(),t.selected["chart-timeline-items-rows"]=e.selected["chart-timeline-items-rows"].slice(),t.selected["chart-timeline-items-row-items"]=e.selected["chart-timeline-items-row-items"].slice(),t}class p extends t{constructor(t,n){super();const c={};c.clearSelection=g,this.unsub=n.state.subscribeAll(["_internal.elements.chart-timeline","_internal.chart.dimensions.width"],e=>{const t=s.get("_internal.elements.chart-timeline");if(void 0===t)return;this.chartTimeline=t,this.chartTimeline.querySelector("."+r)||this.chartTimeline.insertAdjacentElement("beforeend",l);const i=this.chartTimeline.getBoundingClientRect();this.left=i.left,this.top=i.top});const m=e=>{const t=i.api.normalizePointerEvent(e),s=t.x-this.left,n=t.y-this.top;s<=a.startX?(a.fromX=s,a.toX=a.startX):(a.fromX=a.startX,a.toX=s),n<=a.startY?(a.fromY=n,a.toY=a.startY):(a.fromY=a.startY,a.toY=n)},p=(e,t)=>{let i=!1,s=!1;return(e.left>t.left&&e.left<t.right||e.right>t.left&&e.right<t.right||e.left<=t.left&&e.right>=t.right)&&(i=!0),(e.top>t.top&&e.top<t.bottom||e.bottom>t.top&&e.bottom<t.bottom||e.top<=t.top&&e.bottom>=t.bottom)&&(s=!0),i&&s};function v(t,i,n,c){const r=[],l=[],m=i[n+"s"];if(!m)return[];const a=s.get(o),d=a.selecting[n+"s"];for(const i of m){const s=i.getBoundingClientRect();if(p(s,t)){l.push(i.vido),e.canSelect(n,l,a).includes(i.vido)?(d.includes(c(i.vido))||e.selecting(i.vido,n),r.push(c(i.vido))):l.unshift()}else d.includes(c(i.vido))&&e.deselecting(i.vido,n)}return r}const b=e=>{if(a.selecting){{e.stopPropagation(),e.preventDefault();const t=i.api.normalizePointerEvent(e);if(a.startX===t.x-this.left&&a.startY===t.y-this.top)return a.selecting=!1,void(l.style.visibility="hidden")}w(e.ctrlKey)}else{const t=".gantt-schedule-timeline-calendar__chart-timeline-items-row-item";!!e.target.closest(t)?w(e.ctrlKey):e.ctrlKey||g()}};this.mouseDown=e=>{const t=s.get("config.plugin.ItemMovement.movement"),n=t&&t.moving;if("mousedown"===e.type&&0!==e.button||n)return;const c=i.api.normalizePointerEvent(e);a.selecting=!0,a.fromX=c.x-this.left,a.fromY=c.y-this.top,a.startX=a.fromX,a.startY=a.fromY,u=f(s.get(o));!!e.target.closest(".gantt-schedule-timeline-calendar__chart-timeline-items-row-item")||e.ctrlKey||g()},this.mouseMove=e=>{!function(e,t=!1){const i=s.get("config.plugin.ItemMovement.movement"),n=i&&(i.moving||i.waiting);if(!a.selecting||n)return void(n&&(a.selecting=!1));g(!1,!0),m(e),l.style.left=a.fromX+"px",l.style.top=a.fromY+"px",l.style.width=a.toX-a.fromX+"px",l.style.height=a.toY-a.fromY+"px",t||(l.style.visibility="visible");const c=l.getBoundingClientRect(),o=s.get("_internal.elements"),r={};for(const e in d)r[e+"s"]=v(c,o,e,d[e]);h(r,e.ctrlKey)}(e)},this.mouseUp=e=>{a.selecting&&b(e)},t.addEventListener("mousedown",this.mouseDown),t.addEventListener("touchstart",this.mouseDown),document.addEventListener("mousemove",this.mouseMove),document.addEventListener("touchmove",this.mouseMove),document.addEventListener("mouseup",this.mouseUp),document.addEventListener("touchend",this.mouseUp),e.getApi(c)}destroy(e){document.removeEventListener("mouseup",this.mouseUp),document.removeEventListener("touchend",this.mouseUp),document.removeEventListener("mousemove",this.mouseMove),document.removeEventListener("touchmove",this.mouseMove),e.removeEventListener("mousedown",this.mouseDown),e.removeEventListener("touchstart",this.mouseDown),this.unsub()}}function v(e,t,i,s,n){t&&!e.classList.contains(s)?e.classList.add(s):!t&&e.classList.contains(s)&&e.classList.remove(s),i&&!e.classList.contains(n)?e.classList.add(n):!i&&e.classList.contains(n)&&e.classList.remove(n)}class b extends t{constructor(e,t){super(),this.classNameSelecting=n.getClass("chart-timeline-grid-row-block")+"--selecting",this.classNameSelected=n.getClass("chart-timeline-grid-row-block")+"--selected",v(e,t.selecting,t.selected,this.classNameSelecting,this.classNameSelected)}update(e,t){v(e,t.selecting,t.selected,this.classNameSelecting,this.classNameSelected)}destroy(e,t){e.classList.remove(this.classNameSelecting),e.classList.remove(this.classNameSelected)}}class y extends t{constructor(e,t){super(),this.data=t,this.element=e,this.classNameSelecting=n.getClass("chart-timeline-items-row-item")+"--selecting",this.classNameSelected=n.getClass("chart-timeline-items-row-item")+"--selected",this.data=t,this.element=e,this.onPointerDown=this.onPointerDown.bind(this),e.addEventListener("mousedown",this.onPointerDown),e.addEventListener("touchstart",this.onPointerDown),v(e,t.item.selecting,t.item.selected,this.classNameSelecting,this.classNameSelected)}onPointerDown(e){u=f(s.get(o)),a.selecting=!0,this.data.item.selected=!0;const t={"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]};t["chart-timeline-items-row-items"].push(this.data.item.id),h(t),w(e.ctrlKey),v(this.element,this.data.item.selecting,this.data.item.selected,this.classNameSelecting,this.classNameSelected)}update(e,t){v(e,t.item.selecting,t.item.selected,this.classNameSelecting,this.classNameSelected),this.data=t}destroy(e,t){e.classList.remove(this.classNameSelecting),e.classList.remove(this.classNameSelected),e.removeEventListener("mousedown",this.onPointerDown),e.removeEventListener("touchstart",this.onPointerDown)}}function k(e){const t=s.get("config.plugin.selection.selected.chart-timeline-grid-row-blocks");for(const i of t)if(i===e.id)return e.selected=!0,e;return e.selected=!1,e.selecting=!1,e}return function(e){i=e,s=i.state,n=i.api,c=i.schedule,void 0===s.get(o)&&s.update(o,{selecting:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]},selected:{"chart-timeline-grid-rows":[],"chart-timeline-grid-row-blocks":[],"chart-timeline-items-rows":[],"chart-timeline-items-row-items":[]}}),s.update("config.chart.items",e=>{if(e)for(const t in e){const i=e[t];void 0===i.selecting&&(i.selecting=!1),void 0===i.selected&&(i.selected=!1)}return e}),s.update("config.actions.chart-timeline",e=>(e.push(p),e)),s.update("config.actions.chart-timeline-grid-row-block",e=>(e.push(b),e)),s.update("config.actions.chart-timeline-items-row-item",e=>(e.push(y),e)),s.update("config.chart.grid.block.onCreate",e=>(e.push(k),e))}}}));
