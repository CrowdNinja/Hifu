<title><{translate('优惠券管理')}> - <{if $row['id']}><{translate('编辑')}><{else}><{translate('添加')}><{/if}><{translate('优惠券')}> </title>
<div class="page-header">
	<h1>
		<{translate('优惠券管理')}> <small> <i class="ace-icon fa fa-angle-double-right"></i> <{if $row['id']}><{translate('编辑')}><{else}><{translate('添加')}><{/if}><{translate('优惠券')}>
		</small>
	</h1>
</div>
<!-- /.page-header -->
	<script>window.UEDITOR_HOME_URL = '/app/third_party/ueditor1_4_3_3-utf8-php/';</script>
    <script type="text/javascript" charset="utf-8" src="/app/third_party/ueditor1_4_3_3-utf8-php/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="/app/third_party/ueditor1_4_3_3-utf8-php/ueditor.all.min.js"> </script>
    <script type="text/javascript" charset="utf-8" src="/app/third_party/ueditor1_4_3_3-utf8-php/lang/en/en.js"></script>
	<script type="text/plain" id="j_ueditorupload" style="height:5px;display:none;" ></script>
    <script type="text/javascript" charset="utf-8" src="/app/third_party/ueditor1_4_3_3-utf8-php/ueditor.upload.js"></script>

<div class="row">
	<div class="col-md-12">
<div class="main">
    <ul class="nav nav-tabs">
        <li><a href="/admin_system#page/admin_coupon/"><{translate('优惠券列表')}></a></li>
        <li class="active"><a href="/admin_system#page/admin_coupon/edit/<{$row['id']}>"><{if $row['id']}><{translate('编辑')}><{else}><{translate('添加')}><{/if}><{translate('优惠券')}></a></li>
    </ul>

  <div class="panel panel-default">
        <div class="panel-body table-responsive">
        
        		<form class="form-horizontal" role="form" id="submitform" action="/admin_coupon/edit/<{$row['id']}>" method="post" accept-charset="utf-8">
					<{if !$row['id']}>
					<div class="form-group">
						<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right"><{translate('商家')}>:</label>
						<div class="col-xs-12 col-sm-4">
							<span class="block">
								<input id="adminid" name="adminid" value="<{$row['adminid']}>" style="width:100%" />
							</span>
						</div>
						<div class="help-block inline"></div>
					</div>
<script>

$(function () {
    $("#adminid").select2({
		ajax: {
			url: "/admin_shop/search",
			data: function (params) {
				return { 
					keywords: params,
				};
			},
			results:function(data,pageNo){
				if(data.data.length){
					data['data'].splice(0, 0, {'id':'', 'text': "<{translate('请选择')}>"});
				}else{
					data['data'] = [{'id':'', 'text': "<{translate('请选择')}>"}];
				}
				return {
					results:data.data	
				};
			},
			processResults: function (data) { 
				return {
					results: data
				};
			},
			type: 'post',
			dataType: 'json'
		},		
		initSelection: function(elem, cbfunc){
		},
		allowClear: false,
		openOnEnter: false,
		minimumInputLength: 1,
	});

});
</script>    
			<{else}>
            	<input type="hidden" value="<{if $row['adminid']}><{$row['adminid']}><{else}><{$_admin->id}><{/if}>" name="adminid" />
			<{/if}>
            
            <div class="form-group">
		<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right"><{translate('标题')}>*:</label>
		<div class="col-xs-12 col-sm-4">
			<span class="block">
				<input id="title" name="title" value="<{$row['title']}>" class="form-control input-width" required />
			</span>
		</div>
		<div class="help-block inline"></div>
	</div>
    
    	
        <!--<div class="form-group">-->
		<!--<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right">类型:</label>-->
		<!--<div class="col-xs-12 col-sm-5">-->
			<!--<span class="block">-->
            	<!--<select name="type" id="type" class="form-control">-->
               		<!--<{foreach $coupon_type as $k => $v}>                 -->
                		<!--<option value="<{$k}>" <{if strval($row['type'])==strval($k)}>selected<{/if}>><{$v}></option>-->
                	<!--<{/foreach}>-->
                    <!---->
                <!--</select> -->
			<!--</span>-->
		<!--</div>-->
		<!--<div class="help-block inline"></div>-->
	<!--</div>-->


            
			<div class="form-group">
		<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right"><{translate('优惠金额')}>*（<{translate('元')}>）:</label>
		<div class="col-xs-12 col-sm-4">
			<span class="block">
				<input id="money" type="text" name="money" value="<{$row['money']}>" min="0" class="form-control input-width" required />
			</span>
		</div>
		<!--<div class="col-xs-12 col-sm-1">
			<span class="block">
            	<select name="percen" id="percen" class="form-control">
                		<option value="0" <{if strval($row['percen'])==strval(0)}>selected<{/if}>>元</option>
                		<option value="1" <{if strval($row['percen'])==strval(1)}>selected<{/if}>>%</option>
                </select> 
			</span>
		</div>-->
		<div class="help-block inline"></div>
	</div>

      
		<!--	<div class="form-group">
		<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right">领取押金:</label>
		<div class="col-xs-12 col-sm-5">
			<span class="block">
				<input id="foregift" type="text" name="foregift" value="<{$row['foregift']}>" class="form-control input-width" disabled />
			</span>
		</div>
		<div class="help-block inline">* 不填写或0为免费领取</div>
	</div>-->
       
	<div class="form-group">
		<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right"><{translate('使用限额')}>（<{translate('元')}>）:</label>
		<div class="col-xs-12 col-sm-4">
			<span class="block">
				<input id="limit_money" type="text" name="limit_money" min="0" value="<{$row['limit_money']}>" class="form-control input-width" />
			</span>
		</div>
		<div class="help-block inline" style="color:red;">*<{translate('满 ? 元才可用此券，填写0或留空不限制')}> </div>
	</div>
     
	<div class="form-group">
		<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right"><{translate('扫码可领次数')}>:</label>
		<div class="col-xs-12 col-sm-4">
			<span class="block">
				<input id="amount" type="text" name="amount" min="0" value="<{$row['amount']}>" class="form-control input-width"  />
			</span>
		</div>
		<div class="help-block inline" style="color:red;">* <{translate('该值设置为0时不能扫描领取优惠券')}> </div>
	</div>
	<div class="form-group">
		<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right"><{translate('用户限领次数')}>:</label>
		<div class="col-xs-12 col-sm-4">
			<span class="block">
				<input id="limit" type="text" name="limit" min="0" value="<{$row['limit']}>" class="form-control input-width" />
			</span>
		</div>
		<div class="help-block inline" style="color:red;">* <{translate('该值设置为0时不能扫描领取优惠券(用户扫码最大领取数量)')}></div>
	</div>
    
    <!--<div class="form-group">
		<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right">领取期限*:</label>
		<div class="col-xs-12 col-sm-2">
			<span class="block">
				<input id="getbegintime" type="text" name="getbegintime" value="<{formattime($row['getbegintime'], 'Y-m-d', '')}>" class="form-control input-width datetimepicker-date" required />
			</span>
		</div>
		<div class="col-xs-12 col-sm-1">
			<span class="block">
				-
			</span>
		</div>
		<div class="col-xs-12 col-sm-2">
			<span class="block">
				<input id="getendtime" type="text" name="getendtime" value="<{formattime($row['getendtime'], 'Y-m-d', '')}>" class="form-control input-width datetimepicker-date" required />
			</span>
		</div>
		<div class="help-block inline"></div>
	</div>-->
    
    <div class="form-group">
		<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right"><{translate('到期时间')}>*:</label>
		<div class="col-xs-12 col-sm-4">
			<span class="block">
				<input id="end_time" type="text" name="end_time" value="<{$row['end_time']}>" class="form-control input-width " required />
			</span>
		</div>
		<div class="help-block inline"></div>
	</div>
    
    
             
			<div class="form-group">
		<label for="title" class="col-xs-12 col-sm-3 control-label no-padding-right"><{translate('描述')}>:</label>
		<div class="col-xs-12 col-sm-4">
			<span class="block">
				<textarea id="desc" name="desc" maxlength="20" class="form-control input-width"><{$row['desc']}></textarea>
			</span>
		</div>
		<div class="help-block inline"></div>
	</div>

			<div class="form-group">
				<div class="col-sm-offset-3 col-sm-9">
					<button type="button" id="saveedit" class="btn  btn-primary btn-lg"><{translate('提交')}></button>
				</div>
			</div>
		</form>
        </div>
        </div>
	</div>
    </div>
</div>
<script>
    laydate.render({
        elem: '#end_time',
    });

</script>
<script type="text/javascript">
var isbusy = false;
$(function(){
	// var ue = UE.getEditor('editor', { autoFloatEnabled:false });
	// ue.ready(function(){
	// 	ue.setContent($('#text').val(), false);
	// });
	$('#submitform').validate({
			errorElement: 'div',
			errorClass: 'help-block',
			focusInvalid: true,
			rules: {
				title: {
					required: true
				}
			}
	});
	//YYYY-MM-DD HH:mm:ss
	$('.datetimepicker-date').datetimepicker({
		format: 'YYYY-MM-DD',
        language: 'zh-CN',
        pickDate: true,
        pickTime: true,
        hourStep: 1,
        minuteStep: 15,
        secondStep: 30,
        inputMask: true
	});
	$('.datetimepicker').datetimepicker({
		format: 'YYYY-MM-DD HH:mm:ss',
        language: 'zh-CN',
        pickDate: true,
        pickTime: true,
        hourStep: 1,
        minuteStep: 15,
        secondStep: 30,
        inputMask: true
	});
	$('#saveedit').click(function(){
		if(!$('#submitform').valid())return false;
		if(isbusy)return false;
		isbusy = true;
		tooltipbox.show("<{translate('正在执行操作')}>");
		//$('#text').val(ue.getContent());
		$.post('/admin_coupon/edit/<{$row['id']}>', $('#submitform').serialize(), function(res){
			if(res.status == '1'){
				tooltipbox.show("<{translate('操作完成')}>");
				location.href = '/admin_system#page/admin_coupon/';
			}else{
				tooltipbox.show("<{translate('数据或网络错误')}>");
			}
			isbusy = false;
		}, 'json').error(function(a, b, c){
			tooltipbox.show("<{translate('数据或网络错误')}>");
			isbusy = false;
		});
	});
});
</script> 